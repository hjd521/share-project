{"version":3,"file":"bundle-global.js","sources":["../utils/index.js","../reactive/effect.js","../reactive/handlers.js","../reactive/index.js"],"sourcesContent":["export function isObject(data) {\n  return Array.isArray(data) || Object.prototype.toString.call(data) === '[object Object]'\n}\nexport function isString(key) {\n  return typeof key === 'string'\n}\nexport function isIntegerKey(key) {\n  return  isString(key) &&\n  key !== 'NaN' &&\n  key[0] !== '-' &&\n  '' + parseInt(key, 10) === key\n}\nconst hasOwnProperty = Object.prototype.hasOwnProperty\nexport function hasOwn(target,key) {\n  return hasOwnProperty.call(target,key)\n}","let shouldTrack = false\nlet targetMap = new Map()\nlet effectStack = []\nlet activeEffect = null \nlet trackStack = []\nlet uid = 0\n// 暂停监听\nexport function pauseTracking() {\n  trackStack.push(shouldTrack)\n  shouldTrack = false\n}\n// 启动监听\nexport function enableTracking() {\n  trackStack.push(shouldTrack)\n  shouldTrack = true\n}\n// 回复上一次的监听状态\nexport function resetTracking() {\n  const last = trackStack.pop()\n  shouldTrack = last === undefined ? true : last\n}\n// 收集依赖\nexport function track(target, type, key) {\n  if (!shouldTrack || activeEffect === undefined) {\n    return\n  }\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()))\n  }\n  if (!dep.has(activeEffect)) {\n    dep.add(activeEffect)\n    activeEffect.deps.push(dep)\n  }\n}\nexport function trigger(target, type, key, nValue, oValue) {\n  // 拿到存储的dep数组\n  let depsMap = targetMap.get(target)\n  let effects = new Set()\n  if (!depsMap) {\n    return\n  }\n  if (key !== 'undefined') {\n    depsMap.get(key).forEach((effect) => {\n      effects.add(effect)\n    })\n  }\n  effects.forEach((item) => {\n    item()\n  })\n}\nfunction isEffect(fn) {\n  return fn._isEffect === 'true'\n}\nexport function effect(fn, options = {}) {\n  // 防止传入的fn已经\n  if (isEffect(fn)) { // \n    fn = fn.raw\n  }\n  const effect = createReactiveEffect(fn, options)\n  if (!options.lazy) {\n    effect()\n  }\n  return effect\n}\nfunction cleanup(effect) {\n  console.log('清楚')\n}\nfunction createReactiveEffect(fn, options) {\n  const effect = function() {\n    if (!effect.active) {\n      return options.scheduler ? undefined : fn()\n    }\n    if (!effectStack.includes(effect)) {\n      cleanup(effect)\n      try {\n        enableTracking() // 设置可以被监听\n        effectStack.push(effect) // 将当前effect入栈\n        activeEffect = effect // 设置活动effect\n        return fn() // 执行fn\n      } finally {\n        effectStack.pop() // 最后将effect出栈\n        resetTracking() // 出栈-恢复之前是否可以被检测的状态\n        activeEffect = effectStack[effectStack.length - 1] // 设置活动的effect，恢复\n      }\n    }\n  }\n  effect.id = uid++ // uid\n  effect._isEffect = true // 标记为effect\n  effect.active = true\n  effect.raw = fn // 拿到原始函数\n  effect.deps = [] // 存储被观测的属性。\n  effect.options = options // 存储属性\n  return effect\n}","import { hasOwn, isIntegerKey, isObject } from \"../utils/index.js\"\nimport { track,trigger } from \"./effect.js\"\nconst get = createGetter()\nconst set = createSetter()\nlet TrackOpTypes = {\n  GET: 'get',\n  SET: 'set',\n  ADD: 'add'\n}\nfunction hasChanged(n,o) {\n  return !Object.is(n, 0)\n}\nfunction createGetter(isReadonly = false, shallow = false) {\n  return function get(target,key,receiver) {\n    console.log('get')\n    const res = Reflect.get(target, key, receiver)\n    // 如果不是readonly那么收集依赖\n    if(!isReadonly){\n      track(target,TrackOpTypes.GET,key)\n    }\n    // 如果为浅收集，那么直接返回值，不再继续继续往下走了\n    if(shallow){\n        return res;\n    }\n    // 不是shallow，那么应该对value的类型继续reactive\n    if(isObject(res)){ // vue2 是一上来就递归，vue3 是当取值时会进行代理 。 vue3的代理模式是懒代理\n      return isReadonly ? readonly(res) : reactive(res)\n    }\n    return res;\n  }\n}\nfunction createSetter() {\n  return function set(target,key,value, receiver) {\n    let oldValue = target[key]\n    let hadKey = Array.isArray(target) && isIntegerKey(key) ? Number(key) < target.length : hasOwn(target,key);\n    const result = Reflect.set(target, key, value, receiver);\n    if(!hadKey){\n      // 新增 \n      trigger(target,TrackOpTypes.ADD,key,value);\n    }else if(hasChanged(oldValue,value)){\n      // 修改 \n      trigger(target,TrackOpTypes.SET,key,value,oldValue)\n    }\n    return result\n  }\n}\nexport const mutableHandlers = {\n  get,\n  set\n}","import { isObject } from \"../utils\"\nimport {mutableHandlers} from './handlers'\n/**\n * \n * @param {*} target :object\n * @returns proxy instance\n */\nlet readonlyMap = new Map()\nlet reactiveMap = new Map()\nexport function reactive(target) {\n  return createReactiveObject(target, false, mutableHandlers)\n}\n// 创建代理\n// 判断是否是对象或者数组\n// 判断是否已经代理过了\n// \nfunction createReactiveObject(target, isReadonly, baseHandlers) {\n  if (!isObject(target)) {\n    return target\n  }\n  let proxyMap = isReadonly ? readonlyMap : reactiveMap\n  let exist = proxyMap.get(target) // 判断当前对象是否在map中\n  if(exist) {\n    return exist\n  }\n  // 这里还要对target做是否可以被监听的判断，比如是否是冻结的对象。是否是vue生成的可以被跳过的对象。\n  const proxy = new Proxy(target, baseHandlers) // 设置proxy代理get和set\n  proxyMap.set(target, proxy);\n  return proxy\n}"],"names":["reactive"],"mappings":"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"}